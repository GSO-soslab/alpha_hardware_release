
Pending update

## **SBC HAT MK2**
This board was originally design to be connected to a Raspberry PI 4.
However, it should also work with other SBCs with the same GPIO pin arrangement, e.g., Nvidia Jetson SBCs.


### RS232
All the pin functinos for the connectors are indicated on the PCB.

  To enable the I2C to UART chips, you need to edit `/boot/firmware/config.txt` file by adding the following lines.
  
  ```
#RS232 1&2 
dtoverlay=sc16is752-i2c,int_pin=23,addr=0x48
  ```

### ADC ports
Pin 1&2: A0
Pin 3&4: A1
The Voltage input are stepped down using a pair of resitors of 100k and 10k.


### PWM channels
We have 15 PWM channel exposed from the `PCA9685PW` chip. 
ROS driver of the chip can be found [here](https://github.com/uri-ocean-robotics/mvp_hardware_drivers/tree/noetic-devel/pwm_driver).

***Note***
The actual PWM signal generated by the chip maybe slightly off.
We suggest to use a oscilliscope to measure the PWM output.
You can tune the `pwm_ms_bias` parameter to offset the pwm signal to match the number you commanded.

### GPIO
WE have exposed 8 GPIO pins from the PI4.
GPIO7,8,9,10,11,12,13,16
We have a driver based on wiringPi to control the GPIO [here](https://github.com/uri-ocean-robotics/mvp_hardware_drivers/tree/noetic-devel/mvp_gpio_manager)


***Note1:***
The gpio param in the driver is based on the WiringPi pin map.
GPIO7 = 11
GPIO8 = 10
GPIO9 = 13
GPIO10 = 12
GPIO11 = 14
GPIO12 = 26
GPIO13 = 23
GPIO16 = 27

***Note2:***
You can program the gpio initial state to low by adding the commands in `/boot/firmware/config.txt`
```
gpio=13=op,dl
```
where `13` is the GPIO number (not the WiringPi number).

***Note3:***
Continous command from PI is not needed. The PWM will hold the PWM signal based on the last received command.

### MCU
We have a place for soldering a ATtiny85-20P MCU.
The MCU's I2C bus is connected to the PI's I2C, and `PB1` is connected to the `Enable` Pin of the PWM chip.
This allows user to implement safety feature to let MCU to turn off the PWM chip when no data is transmitted from PI to MCU.